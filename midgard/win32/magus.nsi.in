; Generated NSIS script file (generated by makensitemplate.phtml 0.21)
; by 193.189.224.37 on Sep 12 02 @ 07:12

; NOTE: this .NSI script is designed for NSIS v1.8+

!include "MUI.nsh"

!define VERSION @VERSION@
!define WINVERSION -0
!define HOME F:
!define SRCDIR ${HOME}/berlios/midgard
!define BINDIR ${HOME}/winhome/magus2

LoadLanguageFile "${NSISDIR}\Contrib\Language files\German.nlf"

Name "Magus ${VERSION}${WINVERSION}"
OutFile "Magus_${VERSION}${WINVERSION}.exe"
Icon "${SRCDIR}/win32/magus.ico"
UninstallIcon "${SRCDIR}/win32/magus.ico"

XPStyle on

; Some default compiler settings (uncomment and change at will):
; SetCompress auto ; (can be off or force)
; SetDatablockOptimize on ; (can be off)
; CRCCheck on ; (can be off)
; AutoCloseWindow false ; (can be true for the window go away automatically at end)
; ShowInstDetails hide ; (can be show to have them shown, or nevershow to disable)
; SetDateSave off ; (can be on to have files restored to their orginal date)

LicenseText "MAGuS unterliegt der GPL (siehe LICENSE.pdf)"
;LicenseData "/somewhere/COPYING"

InstallDir "$PROGRAMFILES\Magus"
InstallDirRegKey HKEY_LOCAL_MACHINE "SOFTWARE\Magus" ""
;DirShow show ; (make this hide to not let the user change it)
DirText "${NAME} in folgendem Verzeichnis installieren:"

;----------------
;Variables
  Var MUI_TEMP
  Var STARTMENU_FOLDER

;--------------------------------
;Interface Settings

  !define MUI_ABORTWARNING

;--------------------------------
;Pages

;  !insertmacro MUI_PAGE_LICENSE "${NSISDIR}\Docs\Modern UI\License.txt"
  !insertmacro MUI_PAGE_COMPONENTS
  !insertmacro MUI_PAGE_DIRECTORY
  
  ;Start Menu Folder Page Configuration
  !define MUI_STARTMENUPAGE_REGISTRY_ROOT "HKCU" 
  !define MUI_STARTMENUPAGE_REGISTRY_KEY "Software\MAGuS" 
  !define MUI_STARTMENUPAGE_REGISTRY_VALUENAME "Start Menu Folder"
  
  !insertmacro MUI_PAGE_STARTMENU Application $STARTMENU_FOLDER
  
  !insertmacro MUI_PAGE_INSTFILES
  
  !insertmacro MUI_UNPAGE_CONFIRM
  !insertmacro MUI_UNPAGE_INSTFILES

;--------------------------------
;Languages
 
;  !insertmacro MUI_LANGUAGE "German"

Section "diverse benötigte Bibliotheken" ; (default section)
 SetOutPath "$INSTDIR"
; File "${BINDIR}\charset.dll"
 File "${BINDIR}\iconv.dll"
 File "${BINDIR}\intl.dll"
 File "${BINDIR}\jpeg62.dll"
 File "${BINDIR}\libpng12.dll"
 File "${BINDIR}\libpng13.dll"
 File "${BINDIR}\libtiff3.dll"
 File "${BINDIR}\zlib1.dll"
 File "${BINDIR}\mingwm10.dll"
SectionEnd

Section "gtk+ Bibliotheken" ; (default section)
 SetOutPath "$INSTDIR"
 File "${BINDIR}\libatk-1.0-0.dll"
 File "${BINDIR}\libcairo-2.dll"
 File "${BINDIR}\libgdk_pixbuf-2.0-0.dll"
 File "${BINDIR}\libgdk-win32-2.0-0.dll"
 File "${BINDIR}\libglib-2.0-0.dll"
 File "${BINDIR}\libgmodule-2.0-0.dll"
 File "${BINDIR}\libgobject-2.0-0.dll"
 File "${BINDIR}\libgthread-2.0-0.dll"
 File "${BINDIR}\libgtk-win32-2.0-0.dll"
 File "${BINDIR}\libpango-1.0-0.dll"
 File "${BINDIR}\libpangowin32-1.0-0.dll"
 File "${BINDIR}\libpangocairo-1.0-0.dll"
 File /r "${BINDIR}\etc"
 File /r "${BINDIR}\lib"
SectionEnd

Section "gtkmm Bibliotheken" ; (default section)
 SetOutPath "$INSTDIR"

 File "${BINDIR}\libatkmm-1.6-1.dll"
 File "${BINDIR}\libgdkmm-2.4-1.dll"
 File "${BINDIR}\libglibmm-2.4-1.dll"
 File "${BINDIR}\libgtkmm-2.4-1.dll"
 File "${BINDIR}\libpangomm-1.4-1.dll"
 File "${BINDIR}\libsigc-2.0-0.dll"
SectionEnd

Section "MAGuS" ; (default section)
 SetOutPath "$INSTDIR"

 File "${BINDIR}\gtkrc"
 File "${BINDIR}\LICENSE.pdf"
 File "${BINDIR}\libManuProC_Base-0.dll"
 File "${BINDIR}\libmagus-0.dll"
 File "${BINDIR}\libmagusicons-0.dll"
 File "${BINDIR}\magus.exe"

 File "${BINDIR}\Zufallscharakter.exe"
 File "${BINDIR}\magus2txt.exe"
 File "${BINDIR}\magus2pdf.exe"

 File "${BINDIR}\exedebug.exe"
 File "${BINDIR}\exchndl.dll"
SectionEnd

Section "Midgard Dateien" ; (default section)
 SetOutPath "$INSTDIR"

 File /r "${BINDIR}\Daten"
SectionEnd

Section "PDFLaTeX Umgebung" ; (default section)
 SetOutPath "$INSTDIR"

 File "${BINDIR}\pdflatex.exe"
 File /r "${BINDIR}\texmf"
SectionEnd

Section -StartMenu
  !insertmacro MUI_STARTMENU_WRITE_BEGIN Application

  ; Create shortcuts
  CreateDirectory $SMPROGRAMS\$STARTMENU_FOLDER
  CreateShortcut "$SMPROGRAMS\$STARTMENU_FOLDER\MAGuS.lnk" $INSTDIR\magus.exe
  CreateShortCut $SMPROGRAMS\$STARTMENU_FOLDER\Uninstall.lnk $INSTDIR\uninst.exe
  CreateShortCut $SMPROGRAMS\$STARTMENU_FOLDER\LICENSE.lnk $INSTDIR\LICENSE.pdf

  !insertmacro MUI_STARTMENU_WRITE_END
SectionEnd
 
Section "Desktop icon" SecDesktop
  CreateShortcut "$DESKTOP\MAGuS.lnk" $INSTDIR\magus.exe
SectionEnd
 
Section -post
  ; Register Uninstaller
  WriteRegStr HKEY_LOCAL_MACHINE "SOFTWARE\Magus" "" "$INSTDIR"
  WriteRegStr HKEY_LOCAL_MACHINE "Software\Microsoft\Windows\CurrentVersion\Uninstall\Magus" "DisplayName" "Magus (nur entfernen)"
  WriteRegStr HKEY_LOCAL_MACHINE "Software\Microsoft\Windows\CurrentVersion\Uninstall\Magus" "UninstallString" '"$INSTDIR\uninst.exe"'
  ; write out uninstaller
  WriteUninstaller "$INSTDIR\uninst.exe"
SectionEnd ; end of default section


; begin uninstall settings/section
UninstallText "Dies deinstalliert Magus"

Section Uninstall
  ; add delete commands to delete whatever files/registry keys/etc you installed here.
  Delete "$INSTDIR\uninst.exe"
  DeleteRegKey HKEY_LOCAL_MACHINE "SOFTWARE\Magus"
  DeleteRegKey HKEY_LOCAL_MACHINE "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\Magus"
  RMDir "$INSTDIR"
  
  !insertmacro MUI_STARTMENU_GETFOLDER Application $MUI_TEMP

  Delete "$SMPROGRAMS\$MUI_TEMP\Uninstall.lnk"
  
  ;Delete empty start menu parent diretories
  StrCpy $MUI_TEMP "$SMPROGRAMS\$MUI_TEMP"
 
  startMenuDeleteLoop:
	ClearErrors
    RMDir $MUI_TEMP
    GetFullPathName $MUI_TEMP "$MUI_TEMP\.."
    
    IfErrors startMenuDeleteLoopDone
  
    StrCmp $MUI_TEMP $SMPROGRAMS startMenuDeleteLoopDone startMenuDeleteLoop
  startMenuDeleteLoopDone:

  DeleteRegKey /ifempty HKCU "Software\MAGuS"
 
  Delete "$DESKTOP\MAGuS.lnk"
SectionEnd ; end of uninstall section

; eof
